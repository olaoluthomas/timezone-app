# PR Validation Workflow

name: PR Validation

on:
  pull_request:
    types: [opened, reopened, synchronize, labeled, unlabeled]

jobs:
  validate-pr:
    name: Validate PR Labels and Format
    runs-on: ubuntu-latest
    steps:
      - name: Check PR has type label
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          LABELS=$(gh pr view ${{ github.event.pull_request.number }} \
            --repo ${{ github.repository }} \
            --json labels --jq '.labels[].name')

          # Check for at least one type label
          if ! echo "$LABELS" | grep -qE '^(bug|enhancement|documentation|refactor|dependencies)$'; then
            echo "❌ PR missing required type label"
            echo "Required: bug, enhancement, documentation, refactor, or dependencies"
            echo "Current labels: $LABELS"
            exit 1
          fi

          echo "✅ PR has valid type label"

      - name: Validate PR title format
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"

          if ! echo "$PR_TITLE" | grep -qE '^(feat|fix|docs|test|refactor|chore|style|perf)(\(.+\))?:'; then
            echo "❌ PR title must start with conventional commit type"
            echo "Required format: <type>[optional scope]: <description>"
            echo "Examples: feat: add feature, fix(api): fix bug"
            echo "Current title: $PR_TITLE"
            exit 1
          fi

          echo "✅ PR title follows conventional format"